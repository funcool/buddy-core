<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>MAC algorithms</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="highlight/solarized-light.css" /><script type="text/javascript" src="highlight/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a> with <a href="https://github.com/xsc/codox-theme-rdash">RDash UI</a> theme</h2><h1><a href="index.html"><span class="project-title"><span class="project-name">buddy-core</span> <span class="project-version">1.9.0</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Topics</span></h3><ul><li class="depth-1 "><a href="00-introduction.html"><div class="inner"><span>Introduction</span></div></a></li><li class="depth-1 "><a href="01-hash.html"><div class="inner"><span>Hash algorithms (digest)</span></div></a></li><li class="depth-1  current"><a href="02-mac.html"><div class="inner"><span>MAC algorithms</span></div></a></li><li class="depth-1 "><a href="03-keys.html"><div class="inner"><span>Keys</span></div></a></li><li class="depth-1 "><a href="04-dsa.html"><div class="inner"><span>Digital Signatures</span></div></a></li><li class="depth-1 "><a href="05-kdf.html"><div class="inner"><span>Key Derivation Functions (KDF)</span></div></a></li><li class="depth-1 "><a href="06-cipher.html"><div class="inner"><span>Ciphers</span></div></a></li><li class="depth-1 "><a href="07-padding.html"><div class="inner"><span>Paddings</span></div></a></li><li class="depth-1 "><a href="08-nonce.html"><div class="inner"><span>Nonces and Salts</span></div></a></li><li class="depth-1 "><a href="09-certificates.html"><div class="inner"><span>Certificates (X.509)</span></div></a></li><li class="depth-1 "><a href="10-utils.html"><div class="inner"><span>Codecs &amp; Bytes</span></div></a></li><li class="depth-1 "><a href="11-faq.html"><div class="inner"><span>FAQ</span></div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>buddy</span></div></div></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core</span></div></div></li><li class="depth-3 branch"><a href="buddy.core.bytes.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>bytes</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.certificates.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>certificates</span></div></a></li><li class="depth-3"><a href="buddy.core.codecs.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-4"><a href="buddy.core.codecs.base64.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>base64</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.crypto.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>crypto</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.dsa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>dsa</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.hash.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hash</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.kdf.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>kdf</span></div></a></li><li class="depth-3"><a href="buddy.core.keys.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>keys</span></div></a></li><li class="depth-4"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jwk</span></div></div></li><li class="depth-5 branch"><a href="buddy.core.keys.jwk.ec.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ec</span></div></a></li><li class="depth-5 branch"><a href="buddy.core.keys.jwk.eddsa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>eddsa</span></div></a></li><li class="depth-5 branch"><a href="buddy.core.keys.jwk.okp.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>okp</span></div></a></li><li class="depth-5 branch"><a href="buddy.core.keys.jwk.proto.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>proto</span></div></a></li><li class="depth-5"><a href="buddy.core.keys.jwk.rsa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>rsa</span></div></a></li><li class="depth-4"><a href="buddy.core.keys.pem.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>pem</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.mac.html"><div class="inner"><span class="tree" style="top: -238px;"><span class="top" style="height: 247px;"></span><span class="bottom"></span></span><span>mac</span></div></a></li><li class="depth-3 branch"><a href="buddy.core.nonce.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>nonce</span></div></a></li><li class="depth-3"><a href="buddy.core.padding.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>padding</span></div></a></li><li class="depth-2"><div class="no-link"><div class="inner"><span class="tree" style="top: -610px;"><span class="top" style="height: 619px;"></span><span class="bottom"></span></span><span>util</span></div></div></li><li class="depth-3 branch"><a href="buddy.util.deflate.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>deflate</span></div></a></li><li class="depth-3"><a href="buddy.util.ecdsa.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ecdsa</span></div></a></li></ul></div><div class="document" id="content"><div class="doc"><div class="markdown"><h1><a href="#mac-algorithms" name="mac-algorithms"></a>MAC algorithms</h1>
<p>Buddy comes with three mac implementations: <em>hmac</em>, <em>shmac</em> and <em>poly1305</em>; and all them are located under <code>buddy.core.mac</code> namespace.</p>
<h2><a href="#hmac" name="hmac"></a>HMac</h2>
<p>Is a specific construction for calculating a message authentication code (MAC) involving a cryptographic hash function in combination with a secret cryptographic key.</p>
<p>Any cryptographic hash function, such as MD5 or SHA-1, may be used in the calculation of an HMAC; the resulting MAC algorithm is termed HMAC-MD5 or HMAC-SHA1 accordingly. The cryptographic strength of the HMAC depends upon the cryptographic strength of the underlying hash function, the size of its hash output, and on the size and quality of the key.</p>
<p>Example generate a hmac from plain string using sha256 digest</p>
<pre><code class="clojure">;; Import required namespaces
(require '[buddy.core.mac :as mac])
(require '[buddy.core.codecs :as codecs])

;; Generate sha256 hmac over string
(-&gt; (mac/hash "foo bar" {:key "mysecretkey" :alg :hmac+sha256})
    (codecs/bytes-&gt;hex))
;; =&gt; "61849448bdbb67b39d609471eead667e65b0d1b9e01b1c3bf7aa56b83e9c8083"
</code></pre>
<p>Example verifying a hmac</p>
<pre><code class="clojure">(mac/verify "foo bar" (codecs/hex-&gt;bytes "61849448bdbb67b...")
            {:key "mysecretkey" :alg :hmac+sha256})
;; =&gt; true
</code></pre>
<p>The key parameter can be any type that implements the <em>ByteArray</em> protocol defined in the <code>buddy.core.codecs</code> namespace. It comes with default implementations for <code>byte[]</code> and <code>java.lang.String</code> and <code>nil</code>.</p>
<h2><a href="#poly1305" name="poly1305"></a>Poly1305</h2>
<p>Poly1305 is a cryptographic message authentication code (MAC) written by Daniel J. Bernstein. It can be used to verify the data integrity and the authenticity of a message.</p>
<p>The security of Poly1305 is very close to the block cipher algorithm. As a result, the only way for an attacker to break Poly1305 is to break the cipher.</p>
<p>Poly1305 offers cipher replaceability. If anything goes wrong with one, it can be substituted by another with identical security guarantees.</p>
<p>Unlike <em>hmac</em>, it requires an initialization vector (IV). An IV is like a salt. It should be generated using a strong random number generator for security guarantees. Also, the IV should be of the same length as the chosen cipher block size.</p>
<p>Example using poly1305 mac algorithm for generate mac from string:</p>
<pre><code class="clojure">(require '[buddy.core.codecs :as codecs])
(require '[buddy.core.mac :as mac])
(require '[buddy.core.nonce :as nonce])

(def key (nonce/random-bytes 32))
(def iv (nonce/random-bytes 32))

(-&gt; (mac/hash "some-data" {:key key :iv iv :alg :poly1305+aes})
    (codecs/bytes-&gt;hex))
;; =&gt; "1976b1c490c306e7304a59dfacee4207"
</code></pre>
<p>The default specification talks about AES as default block cipher but the algorith in fact can work other block ciphers without any problem. So you can use <code>serpent</code> and twofish among the default aes:</p>
<pre><code class="clojure">(-&gt; (mac/hash "some-data" {:key key :iv iv :alg :poly1305+twofish})
    (codecs/bytes-&gt;hex))
;; =&gt; "6e7304a59dfacee42071976b1c490c30"
</code></pre>
<h2><a href="#advanced-usage" name="advanced-usage"></a>Advanced Usage</h2>
<h3><a href="#generate-mac-for-file-like-objects" name="generate-mac-for-file-like-objects"></a>Generate mac for file like objects</h3>
<p>Like with hash functions, you can use String, byte[], <em>File</em>, <em>URL</em>, <em>URI</em> and <em>InputStream</em> as input value for mac functions:</p>
<p>Example generating hmac from input stream:</p>
<pre><code class="clojure">(require '[clojure.java.io :as io])

;; Generate hmac for file
(-&gt; (io/input-stream "/tmp/somefile")
    (mac/hash {:key "mysecretkey" :alg :hmac-sha256})
    (codecs/bytes-&gt;hex))
;; =&gt; "4cb793e600848da205323800..."
</code></pre>
<h3><a href="#low-level-api" name="low-level-api"></a>Low-Level Api</h3>
<p>Behind the scenes of the high level api, a low level api is already defined with protocols and you can use it for your purposes:</p>
<pre><code class="clojure">(let [engine (mac/-engine {:alg :hnac+sha256})]
  (mac/-update engine (codecs/str-&gt;bytes "hello") 0 5)
  (codecs/bytes-&gt;hex (mac/-end engine)))
;; "924c4b82a56c0115eb9..."
</code></pre>
<p>This also applies to the rest of mac implementations found in <em>buddy-core</em> library.</p></div></div></div></body></html>